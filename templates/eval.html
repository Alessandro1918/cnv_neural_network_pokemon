<!DOCTYPE html>

  <head>
    <script>

      const apiUrl = "{{API_URL}}"

      function handleSubmit(){

        event.preventDefault()

        let formData = new FormData()
        let file = document.getElementById("user-input-file").files[0]
        formData.append("file", file)

        fetch(
          apiUrl + "/eval", 
          {
            method: "POST",
            headers: {
              // "Content-type": "application/json"
              // "Content-type": "multipart/form-data"
              // "Content-type": "image/jpeg; image/jpg; image/png"
            },
            body: formData
          }
        )
          .then(response => response.json())
          .then(response => {
          
            console.log(response)

            //Reset predictions-div
            // let predictions_div = document.getElementById("predictions-div")
            // while (predictions_div.hasChildNodes()) {
            //   predictions_div.removeChild(predictions_div.firstChild);
            // }

            //Add one h3 per object item to a div
            // Object.keys(response).forEach(key => {
            //   const percent = (parseFloat(response[key]) * 100).toFixed(2)
            //   const prediction = document.createElement("h3")
            //   prediction.textContent = key + ": " + percent + "%"
            //   predictions_div.appendChild(prediction)
            // })

            //Reset table
            let table = document.getElementById("predictions-table")
            if (table == null) {
              table = document.createElement("table")
              table.setAttribute("id", "predictions-table")
              document.getElementById("predictions-div").appendChild(table)
            } else {
              while (table.hasChildNodes()) {
                table.removeChild(table.firstChild);
              }
            }
            //Re-add headers
            const tr = document.createElement("tr")
            const th1 = document.createElement("th")
            const th2 = document.createElement("th")
            th1.textContent = "Pokemon"
            th2.textContent = "%"
            tr.appendChild(th1)
            tr.appendChild(th2)
            table.appendChild(tr)
          
            //Add one row per object item to a table
            Object.keys(response).forEach(key => {
              const percent = (parseFloat(response[key]) * 100).toFixed(2)
              const tr = document.createElement("tr")
              const td1 = document.createElement("td")
              const td2 = document.createElement("td")
              td1.textContent = key + ": "
              td2.textContent = percent + "%"
              tr.appendChild(td1)
              tr.appendChild(td2)
              table.appendChild(tr)
            })
          })
      }
    </script>
  </head>

  <body>    
    <h2>
      <a href="https://github.com/Alessandro1918/cnv_neural_network_pokemon">
        Convolutional Neural Network - Pokemon!
      </a>
    </h2>

    <p>A live demo of
      <a href="https://github.com/Alessandro1918/cnv_neural_network_pokemon">
        github.com/Alessandro1918/cnv_neural_network_pokemon
      </a>
    </p>

    <a href="https://github.com/Alessandro1918/cnv_neural_network_pokemon">
      <img 
        src="https://github.com/Alessandro1918/cnv_neural_network_pokemon/blob/main/github_assets/NN.png?raw=true" 
        alt="NN architecture" 
        width="400" 
        height="200"
      >
    </a>

    <form 
      method="post"
      enctype="multipart/form-data"
    >
      <div>
        <label for="file">Choose a pokemon image file to upload:</label>
        </br>
        <!-- "Input file" element: -->
        <input 
          type="file" 
          id="user-input-file" 
          name="file" 
          accept="image/png, image/jpeg"
        />
      </div>
      <div>
        <!-- Submit button: -->
        <input 
          type="submit" 
          value="Eval" 
          onclick="handleSubmit()"
        >
      </div>
    </form>

    <div id="predictions-div"></div>

  </body>

</html>